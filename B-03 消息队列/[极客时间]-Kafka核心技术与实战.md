# 开篇词

**为什么要学习 Kafka?**

日常工作中，如何应对数据量激增、数据复杂度增加以及数据变化速率变化问题？

对于数据量激增来说，Kafka 能够有效隔离上下游业务，将上游突增的流量缓存起来，以平滑的方式传导到下游子系统中。

学习 Kafka 也涉及到其他技术，比如：消息引擎应用、应用程序集成、分布式存储构建、流处理应用的开发与部署。

**如何学习 Kafka?**

第一步：掌握 Kafka 客户端，去官网学习代码示例。

第二步：学习 Kafka 的高级功能，比如流处理应用开发。

**专栏的组成**

第一部分：消息引擎这类系统原理和用途；

第二部分：Kafka 如何用于生产环境；

第三部分：学习 Kafka 客户端；

第四部分：Kafka 核心设计原理；

第五部分：Kafka 运维与监控；

第六部分：Kafka 流处理组件 Kafka Streams 实战应用；

# 01 | Kafka 介绍

**Kafka 是什么？**

Apache Kafka 是一款开源的消息引擎系统 Messaging System，就像引擎一样，具备某种能量转换传输的能力。

**Kafka 是做什么用的？**

根据维基百科的定义，消息引擎系统是一组规范。企业利用这组规范在不同系统之间传递语义准确的消息，实现松耦合的异步式数据传递。

通俗来讲，就是系统 A 发送消息给消息引擎系统，系统 B 从消息引擎系统中读取 A 发送的消息。

**如何设计消息的传输格式？**

Kafka 使用的是纯二进制的字节序列。消息还是结构化的，只是在使用之前都要将其转换成二进制的字节序列。

**怎么把消息传输出去？**

常见的有两种方法：

- 点对点模型：系统 A 发送的消息只能被系统 B 接收，其他任何系统都不能读取 A 发送的消息。
- 发布 / 订阅模型：它有一个主题（Topic）的概念，你可以理解成逻辑语义相近的消息容器。发送方称为发布者（Publisher），接收方称为订阅者（Subscriber）。和点对点模型不同的是，这个模型可能存在多个发布者向相同的主题发送消息，而订阅者也可能存在多个，它们都能接收到相同主题的消息。生活中的报纸订阅就是一种典型的发布 / 订阅模型。

**为什么不直接发送而要通过消息引擎发送消息？**

削峰填谷、解耦、异步。这就是 Kafka 这类消息引擎系统的最大意义所在。

# 02 | Kafka 术语

- 消息：Record。Kafka 是消息引擎嘛，这里的消息就是指 Kafka 处理的主要对象。
- 主题：Topic。主题是承载消息的逻辑容器，在实际使用中多用来区分具体的业务。
- 分区：Partition。分区是指一个有序不变的消息序列，每个主题下可以有多个分区。生产者生产的每条消息只会被发送到一个分区中。
- 消息位移：Offset。表示分区中每条消息的位置信息，是一个单调递增且不变的值。
- 副本：Replica。Kafka 中同一条消息能够被拷贝到多个地方以提供数据冗余，这些地方就是所谓的副本。副本还分为领导者副本和追随者副本，各自有不同的角色划分。副本是在分区层级下的，即每个分区可配置多个副本实现高可用。
- 生产者：Producer。向主题发布新消息的应用程序。
- 消费者：Consumer。从主题订阅新消息的应用程序。
- 消费者位移：Consumer Offset。表征消费者消费进度，每个消费者都有自己的消费者位移。
- 消费者组：Consumer Group。多个消费者实例共同组成的一个组，同时消费多个分区以实现高吞吐。
- 重平衡：Rebalance。消费者组内某个消费者实例挂掉后，其他消费者实例自动重新分配订阅主题分区的过程。Rebalance 是 Kafka 消费者端实现高可用的重要手段。
- 消息日志：Log。Kafka 使用消息日志（Log）来保存数据，一个日志就是磁盘上一个只能追加写（Append-only）消息的物理文件。
- 日志段：Log Segment。Kafka 要定期地删除消息以回收磁盘。怎么删除呢？简单来说就是通过日志段（Log Segment）机制。

这些概念可以用一张图来展示。

![image-20201122001949780](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20201122001949.png)









